\documentclass{standalone}
\input{../_common.tex}

\begin{document}
\begin{tikzpicture}
    \pgfplotstableread[col sep=comma,header=true]{results.csv}\data

    %────────────────── 1×2 GROUPPLOT ──────────────────
    \begin{groupplot}[
        group style={
            group size=1 by 2,
            vertical sep=1.5cm
        },
        legend style={/tikz/every even column/.append style={column sep=0.6cm}}
    ]

    %─── TOP: F-Measure ─────────────────────────────────
    \nextgroupplot[
        ybar,
        width=16cm,
        height=8cm,
        bar width=15pt,
        enlarge x limits=0.15,
        ylabel={F-Measure},
        ymin=0, ymax=0.8,
        xtick=data,
        xticklabels from table={\data}{abbr},
        xticklabel style={rotate=15, anchor=east},
        nodes near coords,
        nodes near coords align={above},
        nodes near coords style={/pgf/number format/fixed, /pgf/number format/precision=3},
        grid=major,
        area legend
    ]
        % Baseline ───────────────────────────────────────────────────────
        \addplot[
            ybar,
            bar width=15pt,
            fill=plotColor1*,
            draw=black,
            thick
        ] coordinates {(0,0.750)};

        % Contextual Markov Model – group 1 (Exploratory, Lookup) ────────
        \addplot[
            ybar,
            bar width=15pt,
            fill=plotColor2*,
            pattern=north east lines,
            pattern color=black,
            draw=black,
            thick
        ] coordinates {(1,0.568) (2,0.509)};

        % Contextual Markov Model – group 2 (Specification, Generalisation,
        % Substitution, New Topic) ───────────────────────────────────────
        \addplot[
            ybar,
            bar width=15pt,
            fill=plotColor3*,
            pattern=crosshatch,
            pattern color=black,
            draw=black,
            thick
        ] coordinates {(3,0.453) (4,0.562) (5,0.502) (6,0.475)};

        % Single legend entry for all F-Measure bars
        \addlegendimage{ybar,fill=plotColor1*,draw=black,thick}
        \addlegendentry{F-Measure}

    %─── BOTTOM: KS-2 D-statistic ───────────────────────
    \nextgroupplot[
        width=16cm,
        height=4cm,
        ylabel={KS-2 D-statistic},
        ymin=0.0025, ymax=0.0045,
        xtick=data,
        xticklabels from table={\data}{abbr},
        xticklabel style={rotate=15, anchor=east},
        grid=major,
        every axis plot/.append style={thick}
    ]
        % KS-2 D-statistic ───────────────────────────────────────────────
        \addplot[
            plotColor1,
            mark=square*,
            mark size=2.5pt,
            thick
        ] table[x=id, y=ks_d_statistic] {\data};
        \addlegendentry{KS-2 D-statistic}

        % KS-2 D-critical ────────────────────────────────────────────────
        \addplot[
            dashed,
            plotColor3,
            mark=o,
            mark size=2.5pt,
            mark options={fill=background, draw=plotColor3},
            thick
        ] table[x=id, y=ks_d_critical] {\data};
        \addlegendentry{KS-2 D-critical}

    \end{groupplot}

    % --- Abbreviation key -------------------------------------------------
    \node[
        anchor=north,
        font=\footnotesize,
        text width=16cm,
        align=center
    ] at (current bounding box.south)
    {\textbf{Abbreviations:}
     BL = Baseline,\; EXP = Exploratory,\; LKP = Lookup,\;
     SPEC = Specification,\; GEN = Generalisation,\;
     SUB = Substitution,\; NEW = New Topic};
\end{tikzpicture}
\end{document}