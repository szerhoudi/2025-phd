\documentclass{standalone}
\input{../_common.tex}

\begin{document}
\begin{tikzpicture}[
    node distance=1cm and 1.8cm,
    fignode/.style={
        draw,
        rounded corners,
        minimum height=1cm,
        minimum width=2cm,
        align=center,
        font=\small
    },
    innode/.style={
        fignode,
        fill=plotColor3!10,
    },
    block/.style={
        fignode,
        minimum height=1.6cm,
        minimum width=9cm,
    },
    arr/.style={-latex, thick}
]

% Inputs (sequence)
\node[innode] (i1) {$i_1$};
\node[innode, right=of i1] (i2) {$i_2$};
\node (dots) at ($(i2.east) + (0.75, 0)$) {\dots};
\node[innode, right=of dots] (it) {$i_{t-1}$};

% GRU block
\node[block, fill=plotColor2!20, below=of dots] (gru) {\textbf{GRU}};

% FFN block and output
\node[block, fill=white, minimum width=3.2cm, below=of gru] (ffn) {Feed-Forward \\ Network};
\node[below=of ffn, text=plotColor1] (pred) {\textbf{Predicted Action} $p_a$};

% Flow arrows
\draw[arr] (i1) -- (i1 |- gru.north);
\draw[arr] (i2) -- (i2 |- gru.north);
\draw[arr] (it) -- (it |- gru.north);

% Recurrent connection (clear single loop)
\draw[arr, dashed, draw=plotColor2] (gru.west) to[bend right=45] node[midway, left, xshift=-2pt] {\footnotesize recurrent} (gru.north west);

% State to FFN and to output
\draw[arr] (gru) -- node[midway, right] {State $s_t$} (ffn);
\draw[arr] (ffn) -- node[midway, right, yshift=2pt] {\footnotesize softmax} (pred);

\end{tikzpicture}
\end{document}